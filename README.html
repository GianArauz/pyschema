

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>PySchema &mdash; PySchema 1.0a1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="PySchema 1.0a1 documentation" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> PySchema</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="simple">
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_api/pyschema.html">pyschema package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="_api/pyschema.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api/pyschema.html#module-pyschema.core">pyschema.core module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api/pyschema.html#module-pyschema.types">pyschema.types module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api/pyschema.html#module-pyschema">Module contents</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_api_extensions/pyschema_extensions.html">pyschema_extensions package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#module-pyschema_extensions.avro">pyschema_extensions.avro module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#module-pyschema_extensions.avro_to_pyschema">pyschema_extensions.avro_to_pyschema module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#module-pyschema_extensions.jsonschema">pyschema_extensions.jsonschema module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#module-pyschema_extensions.luigi">pyschema_extensions.luigi module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#module-pyschema_extensions.postgres">pyschema_extensions.postgres module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#module-pyschema_extensions">Module contents</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">PySchema</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>PySchema</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/README.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="pyschema">
<h1>PySchema<a class="headerlink" href="#pyschema" title="Permalink to this headline">¶</a></h1>
<p>PySchema is a library for Python class declaration with typed fields
that can be introspected and have data contracts associated with them.
This allows for better data integrity checks when
serializing/deserializing data and safe interaction with external tools
that require typed data.</p>
<p>The foremost design principle when creating the library was to keep the
definitions very concise and easy to read. Inspiration was taken from
Django&#8217;s ORM and the main use cases in mind has been database
interaction (Postgres) and Apache Avro schema/datum generation.</p>
<p>It has been tested on Python 2.6 and Python 2.7</p>
<div class="section" id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="_api/pyschema.html">pyschema package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="_api/pyschema.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api/pyschema.html#module-pyschema.core">pyschema.core module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api/pyschema.html#module-pyschema.types">pyschema.types module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api/pyschema.html#module-pyschema">Module contents</a></li>
</ul>
</li>
</ul>
</div>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="_api_extensions/pyschema_extensions.html">pyschema_extensions package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#module-pyschema_extensions.avro">pyschema_extensions.avro module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#module-pyschema_extensions.avro_to_pyschema">pyschema_extensions.avro_to_pyschema module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#module-pyschema_extensions.jsonschema">pyschema_extensions.jsonschema module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#module-pyschema_extensions.luigi">pyschema_extensions.luigi module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#module-pyschema_extensions.postgres">pyschema_extensions.postgres module</a></li>
<li class="toctree-l2"><a class="reference internal" href="_api_extensions/pyschema_extensions.html#module-pyschema_extensions">Module contents</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">Record</span></tt> base class is the easiest way to define schemas. Typed
fields in the schema are defined using subclasses of <tt class="docutils literal"><span class="pre">Field</span></tt>. Standard
field types are defined in <tt class="docutils literal"><span class="pre">pyschema.types</span></tt> and are also aliased in
the pyschema package.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyschema</span> <span class="kn">import</span> <span class="n">Record</span><span class="p">,</span> <span class="n">dumps</span><span class="p">,</span> <span class="n">loads</span>
<span class="kn">from</span> <span class="nn">pyschema.types</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="section" id="declaration">
<h4>Declaration<a class="headerlink" href="#declaration" title="Permalink to this headline">¶</a></h4>
<p>To define a schema, use a Python class declaration inheriting from
<tt class="docutils literal"><span class="pre">pyschema.Record</span></tt>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyRecord</span><span class="p">(</span><span class="n">Record</span><span class="p">):</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">Text</span><span class="p">()</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="class-instantiation">
<h4>Class instantiation<a class="headerlink" href="#class-instantiation" title="Permalink to this headline">¶</a></h4>
<p>Like a typical Python class instantiation. All fields are keyword
arguments to the constructor of the record.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">r</span> <span class="o">=</span> <span class="n">MyRecord</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s">&quot;hej&quot;</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="member-access">
<h4>Member access<a class="headerlink" href="#member-access" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">r</span><span class="o">.</span><span class="n">foo</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;hej&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="default-string-representation-repr">
<h4>Default string representation/repr<a class="headerlink" href="#default-string-representation-repr" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">r</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">MyRecord</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s">&#39;hej&#39;</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="simple-json-serialization">
<h4>Simple json serialization<a class="headerlink" href="#simple-json-serialization" title="Permalink to this headline">¶</a></h4>
<p>Creates a json compatible string representing the object. A special
<tt class="docutils literal"><span class="pre">$schema</span></tt> field is added to the json to allow parsing of the record
without prior knowledge of the which schema to use. The name of this
special field can be set to something else using the
<tt class="docutils literal"><span class="pre">pyschema.core.set_schema_name_field</span></tt></p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">s</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="k">print</span> <span class="n">s</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;$schema&quot;</span><span class="p">:</span> <span class="s">&quot;MyRecord&quot;</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">:</span> <span class="s">&quot;hej&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</pre></div>
</div>
<p>####... and deserialization</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">o</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">print</span> <span class="n">o</span><span class="o">.</span><span class="n">bar</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="built-in-types">
<h3>Built-in types<a class="headerlink" href="#built-in-types" title="Permalink to this headline">¶</a></h3>
<p>PySchema comes with a standard set of field types that can be used to
represent the most commonly used data types</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Text</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Integer</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Float</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Bytes</span></tt> - for binary data, the equivalent of Python &lt; 3 <tt class="docutils literal"><span class="pre">str</span></tt> or
Python 3 <tt class="docutils literal"><span class="pre">bytes</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Boolean</span></tt> - True or False</li>
<li><tt class="docutils literal"><span class="pre">Date</span></tt> - <tt class="docutils literal"><span class="pre">datetime.date</span></tt> objects</li>
<li><tt class="docutils literal"><span class="pre">DateTime</span></tt> - <tt class="docutils literal"><span class="pre">datetime.datetime</span></tt> objects</li>
<li><tt class="docutils literal"><span class="pre">Enum</span></tt> - only allows a preset of text values (specified as an
arguemnt to the constructor)</li>
<li><tt class="docutils literal"><span class="pre">List</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Map</span></tt></li>
<li><tt class="docutils literal"><span class="pre">SubRecord</span></tt></li>
</ul>
</div>
</div>
<div class="section" id="complex-types">
<h2>Complex types<a class="headerlink" href="#complex-types" title="Permalink to this headline">¶</a></h2>
<p>Some types function as containers for other types.</p>
<p>Lists allow storage of ordered sequences of a single type of data,
specified as an argument to the field constructor</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RecordWithList</span><span class="p">(</span><span class="n">Record</span><span class="p">):</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Integer</span><span class="p">())</span>

<span class="n">RecordWithList</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">RecordWithList</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>Storage for dictionaries mapping from strings to values of a single
type, specified as an argument to the field constructor</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RecordWithMap</span><span class="p">(</span><span class="n">Record</span><span class="p">):</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="n">Boolean</span><span class="p">())</span>

<span class="n">RecordWithMap</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="p">{</span><span class="s">u&quot;word&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">RecordWithMap</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="p">{</span><span class="s">u&#39;word&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
</pre></div>
</div>
<p>SubRecords allow for nesting of records, i.e. storing records of some
sort as fields in other records. SubRecord takes an argument being the
schema (i.e. Record class) of the intended stored object. Recursive
nesting can also be used by supplying <tt class="docutils literal"><span class="pre">pyschema.SELF</span></tt> as the schema
type to SubRecord, in which case the field accepts records of the parent
record type.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NestedRecord</span><span class="p">(</span><span class="n">Record</span><span class="p">):</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">SubRecord</span><span class="p">(</span><span class="n">MyRecord</span><span class="p">)</span>  <span class="c"># MyRecord is defined above...</span>

<span class="n">NestedRecord</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="n">MyRecord</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">NestedRecord</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="n">MyRecord</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NestedSelfRecord</span><span class="p">(</span><span class="n">Record</span><span class="p">):</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">SubRecord</span><span class="p">(</span><span class="n">SELF</span><span class="p">)</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">Text</span><span class="p">()</span>

<span class="n">NestedSelfRecord</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="n">NestedSelfRecord</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="s">&quot;Second&quot;</span><span class="p">),</span> <span class="n">bar</span><span class="o">=</span><span class="s">&quot;First&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">NestedSelfRecord</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="n">NestedSelfRecord</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="s">&#39;Second&#39;</span><span class="p">),</span> <span class="n">bar</span><span class="o">=</span><span class="s">&#39;First&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Complex types are field types just like any other, so they can be
combined to create complex data structures</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Part</span><span class="p">(</span><span class="n">Record</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>
    <span class="n">good</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">()</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Text</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">AdvancedRecord</span><span class="p">(</span><span class="n">Record</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Text</span><span class="p">()</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="n">SubRecord</span><span class="p">(</span><span class="n">Part</span><span class="p">))</span>

<span class="n">AdvancedRecord</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">u&quot;tool_1&quot;</span><span class="p">,</span>
    <span class="n">parts</span><span class="o">=</span><span class="p">{</span>
        <span class="s">u&quot;moo&quot;</span><span class="p">:</span> <span class="n">Part</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="s">u&quot;buzz&quot;</span><span class="p">,</span>
            <span class="n">good</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">attributes</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;something&quot;</span><span class="p">,</span> <span class="s">&quot;other&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">AdvancedRecord</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">u&#39;tool_1&#39;</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="p">{</span><span class="s">u&#39;moo&#39;</span><span class="p">:</span> <span class="n">Part</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">u&#39;buzz&#39;</span><span class="p">,</span> <span class="n">good</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;something&#39;</span><span class="p">,</span> <span class="s">&#39;other&#39;</span><span class="p">])})</span>
</pre></div>
</div>
</div>
<div class="section" id="defaults">
<h2>Defaults<a class="headerlink" href="#defaults" title="Permalink to this headline">¶</a></h2>
<p>All fields are optional in the constructor, left-out fields are <tt class="docutils literal"><span class="pre">None</span></tt>
by default, except for the <tt class="docutils literal"><span class="pre">Map</span></tt> and <tt class="docutils literal"><span class="pre">List</span></tt> types where they default
to their respective empty containers <tt class="docutils literal"><span class="pre">{}</span></tt> and <tt class="docutils literal"><span class="pre">[]</span></tt>.</p>
<p>MyRecord(bar=10)</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">OtherRecord</span><span class="p">(</span><span class="n">Record</span><span class="p">):</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="n">Float</span><span class="p">())</span>
    <span class="n">baz</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Integer</span><span class="p">())</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">OtherRecord</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">OtherRecord</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="p">{},</span> <span class="n">baz</span><span class="o">=</span><span class="p">[])</span>
</pre></div>
</div>
<p>Fails at serialization time when types don&#8217;t match</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">broken_record</span> <span class="o">=</span> <span class="n">MyRecord</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c"># object creation works with any types (to allow for temporary unallowed values)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">broken_record</span>  <span class="c"># repr format also still works</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">MyRecord</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">dumps</span><span class="p">(</span><span class="n">broken_record</span><span class="p">)</span>  <span class="c"># raises an Exception because 5 isn&#39;t a text format</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

&lt;ipython-input-17-92114c8b8749&gt; in &lt;module&gt;()
----&gt; 1 print dumps(broken_record)  # raises an Exception because 5 isn&#39;t a text format


/Users/freider/Code/spotify/pyschema/pyschema/core.py in dumps(obj, attach_schema_name)
    494
    495 def dumps(obj, attach_schema_name=True):
--&gt; 496     json_dct = to_json_compatible(obj)
    497     if attach_schema_name:
    498         json_dct[SCHEMA_FIELD_NAME] = obj._schema_name


/Users/freider/Code/spotify/pyschema/pyschema/core.py in to_json_compatible(record)
    384         val = getattr(record, fname)
    385         if val is not None:
--&gt; 386             d[fname] = f.dump(val)
    387     return d
    388


/Users/freider/Code/spotify/pyschema/pyschema/types.pyc in dump(self, obj)
     34             except:
     35                 raise ValueError(
---&gt; 36                     &quot;%r is not a valid UTF-8 string&quot; % obj
     37                 )
     38


ValueError: 5 is not a valid UTF-8 string
</pre></div>
</div>
<div class="section" id="extending-pyschema">
<h3>Extending PySchema<a class="headerlink" href="#extending-pyschema" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="create-new-custom-field-types">
<h2>Create new custom <tt class="docutils literal"><span class="pre">Field</span></tt> types<a class="headerlink" href="#create-new-custom-field-types" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">class</span> <span class="nc">Date</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)))</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyOtherRecord</span><span class="p">(</span><span class="n">Record</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">Date</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">s</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">MyOtherRecord</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">)))</span>
<span class="k">print</span> <span class="s">&quot;Serialized:&quot;</span><span class="p">,</span> <span class="n">s</span>
<span class="k">print</span> <span class="s">&quot;Reloaded:&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Serialized: {&quot;date&quot;: &quot;2013-10-07&quot;, &quot;$schema&quot;: &quot;MyOtherRecord&quot;}
Reloaded: datetime.date(2013, 10, 7)
</pre></div>
</div>
</div>
<div class="section" id="add-mixins-on-existing-field-types-to-simplify-adding-functionality-while-maintaining-oo-structure">
<h2>Add mixins on existing field types to simplify adding functionality while maintaining OO structure<a class="headerlink" href="#add-mixins-on-existing-field-types-to-simplify-adding-functionality-while-maintaining-oo-structure" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">Text</span><span class="o">.</span><span class="n">postgres_type</span> <span class="o">=</span> <span class="s">&quot;TEXT&quot;</span>
<span class="n">Integer</span><span class="o">.</span><span class="n">postgres_type</span> <span class="o">=</span> <span class="s">&quot;INTEGER&quot;</span>

<span class="nd">@List.mixin</span>
<span class="k">class</span> <span class="nc">ListPostgresMixin</span><span class="p">:</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">postgres_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_type</span><span class="o">.</span><span class="n">postgres_type</span> <span class="o">+</span> <span class="s">&quot; ARRAY&quot;</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">create_table_from_record</span><span class="p">(</span><span class="n">schema</span><span class="p">):</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">field_type</span><span class="o">.</span><span class="n">postgres_type</span><span class="p">))</span>
    <span class="k">return</span> <span class="s">&quot;CREATE TABLE </span><span class="si">%s</span><span class="s"> (&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">_schema_name</span><span class="p">,)</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyTable</span><span class="p">(</span><span class="n">Record</span><span class="p">):</span>
    <span class="n">list_name</span> <span class="o">=</span> <span class="n">Text</span><span class="p">()</span>
    <span class="n">numbers</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Integer</span><span class="p">())</span>

<span class="n">create_table_from_record</span><span class="p">(</span><span class="n">MyTable</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;CREATE TABLE MyTable (list_name TEXT, numbers INTEGER ARRAY)&#39;</span>
</pre></div>
</div>
<p>The following will trigger an error since we haven&#8217;t mixed in the
<tt class="docutils literal"><span class="pre">postgres_type</span></tt> field for the <tt class="docutils literal"><span class="pre">Map</span></tt> field type in this example.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Impossibru</span><span class="p">(</span><span class="n">Record</span><span class="p">):</span>
    <span class="n">numbers</span> <span class="o">=</span> <span class="n">Map</span><span class="p">(</span><span class="n">Integer</span><span class="p">())</span>

<span class="n">create_table_from_record</span><span class="p">(</span><span class="n">Impossibru</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

&lt;ipython-input-24-65f7b1968e1a&gt; in &lt;module&gt;()
      2     numbers = Map(Integer())
      3
----&gt; 4 create_table_from_record(Impossibru)


&lt;ipython-input-22-61f11a5f0ce7&gt; in create_table_from_record(schema)
      2     parts = []
      3     for name, field_type in schema._fields.iteritems():
----&gt; 4         parts.append(&quot;%s %s&quot; % (name, field_type.postgres_type))
      5     return &quot;CREATE TABLE %s (&quot; % (schema._schema_name,) + &quot;, &quot;.join(parts) + &quot;)&quot;


AttributeError: &#39;Map&#39; object has no attribute &#39;postgres_type&#39;
</pre></div>
</div>
<div class="section" id="under-the-hood">
<h3>Under the hood<a class="headerlink" href="#under-the-hood" title="Permalink to this headline">¶</a></h3>
<p>In this section, a brief explanation of the underlying architecture of
the package is presented.</p>
</div>
</div>
<div class="section" id="id1">
<h2>Declaration<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>PySchema utilizes a Schema metaclass for the Record class that hooks
into the class declaration logic of the python interpreter.</p>
<p>When a subclass of Record is <em>declared</em>, the metaclass will go through
the class properties and create some helper variables needed for schema
introspection and general setup. To be able to keep ordering of fields,
a counter is increased every time a Field is declared and this is used a
the sorting key in the ordered schema.</p>
<p>The metaclass is responsible for setting up the following magic
variables on the schema <em>class</em>: * <tt class="docutils literal"><span class="pre">_fields</span></tt> - contains an
OrderedDict of (<em>name</em>, <em>field</em>) mappings, where <em>name</em> is the field
name and <em>field</em> is the Field instance, i.e. the type definition
instance for the field. E.g. <tt class="docutils literal"><span class="pre">(&quot;foo&quot;,</span> <span class="pre">Integer(size=4))</span></tt> *
<tt class="docutils literal"><span class="pre">_schema_name</span></tt> - the name of the schema. Typically the same as the
class name.</p>
</div>
<div class="section" id="instantiation">
<h2>Instantiation<a class="headerlink" href="#instantiation" title="Permalink to this headline">¶</a></h2>
<p>When a Record is instantiated, a new object is created where each field
is filled with its default value.</p>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Elias Freider.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0a1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>